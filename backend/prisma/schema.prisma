generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Estabelecimento {
  id            Int       @id @default(autoincrement())
  nome          String
  documento     String
  cep           String
  endereco      String
  taxa_servico  Float
  logo_url      String   @db.Text
  tema_fundo_geral String? @db.VarChar(20)
  tema_fundo_cartoes String? @db.VarChar(20)
  tema_cor_texto String? @db.VarChar(20)
  tema_cor_primaria String? @db.VarChar(20)
  tema_cor_destaque String? @db.VarChar(20)
  criadoEm      DateTime  @default(now())
  atualizadoEm  DateTime  @updatedAt

  administradores UsuarioAdmin[]
  garcons        Garcom[]
  categorias     Categoria[]
  produtos       Produto[]
  pedidos        Pedido[] @relation("EstabPedidos")
  mesas          Mesa[]
}

model UsuarioAdmin {
  id               Int     @id @default(autoincrement())
  usuario          String
  senhaHash        String
  estabelecimento  Estabelecimento @relation(fields: [estabelecimentoId], references: [id], onDelete: Cascade)
  estabelecimentoId Int
  criadoEm         DateTime @default(now())
}

model Garcom {
  id               Int    @id @default(autoincrement())
  nome             String
  senhaHash        String
  ativo            Boolean @default(true)
  estabelecimento  Estabelecimento @relation(fields: [estabelecimentoId], references: [id], onDelete: Cascade)
  estabelecimentoId Int
  pedidos          Pedido[] @relation("GarcomPedidos")
  criadoEm         DateTime @default(now())
}

model Categoria {
  id               Int    @id @default(autoincrement())
  nome             String
  estabelecimento  Estabelecimento @relation(fields: [estabelecimentoId], references: [id], onDelete: Cascade)
  estabelecimentoId Int
  produtos         Produto[]
}

model Produto {
  id               Int    @id @default(autoincrement())
  nome             String
  preco            Float
  descricao        String?  @db.Text
  imagem_url       String?  @db.Text
  categoria        Categoria? @relation(fields: [categoriaId], references: [id], onDelete: Cascade)
  categoriaId      Int?
  estabelecimento  Estabelecimento @relation(fields: [estabelecimentoId], references: [id], onDelete: Cascade)
  estabelecimentoId Int
  criadoEm         DateTime @default(now())
  itensPedido      ItemPedido[] @relation("ProdutoItens")
}

model Mesa {
  id               Int    @id @default(autoincrement())
  numero           String
  aberta           Boolean @default(true)
  taxaPaga         Boolean @default(false)
  fechadaEm        DateTime?
  estabelecimento  Estabelecimento @relation(fields: [estabelecimentoId], references: [id], onDelete: Cascade)
  estabelecimentoId Int
  pedidos          Pedido[]
  criadoEm         DateTime @default(now())
}

model Notification {
  id                 Int      @id @default(autoincrement())
  tipo               String
  referenciaId       Int?
  mesaId             Int?
  pedidoId           Int?
  titulo             String?
  body               String?
  atendido           Boolean  @default(false)
  atendidoPorGarcomId Int?
  atendidoEm         DateTime?
  criadoEm           DateTime @default(now())
  estabelecimentoId  Int?
}

model Avaliacao {
  id               Int      @id @default(autoincrement())
  estrelas         Int
  comentario       String?  @db.Text
  mesaId           Int?
  pedidoId         Int?
  criadoEm         DateTime @default(now())
  estabelecimentoId Int?
}
 

model Pedido {
  id               Int    @id @default(autoincrement())
  mesa             Mesa   @relation(fields: [mesaId], references: [id], onDelete: Cascade)
  mesaId           Int
  garcom           Garcom @relation("GarcomPedidos", fields: [garcomId], references: [id], onDelete: Cascade)
  garcomId         Int
  estabelecimento  Estabelecimento @relation("EstabPedidos", fields: [estabelecimentoId], references: [id], onDelete: Cascade)
  estabelecimentoId Int
  status           PedidoStatus @default(PENDENTE)
  total            Float
  itens            ItemPedido[]
  criadoEm         DateTime @default(now())
}

model ItemPedido {
  id        Int     @id @default(autoincrement())
  pedido    Pedido  @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  pedidoId  Int
  produto   Produto @relation("ProdutoItens", fields: [produtoId], references: [id], onDelete: Cascade)
  produtoId Int
  quantidade Int
  precoUnitario Float
}

enum PedidoStatus {
  PENDENTE
  ENVIADO
  SERVIDO
  FECHADO
}
